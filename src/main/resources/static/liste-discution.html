<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des Discussions</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffcc66;
      margin: 0;
      padding: 0;
    }

    .tab-bar {
      display: flex;
      justify-content: center;
      background: #ff007f;
      border-bottom-left-radius: 25px;
      border-bottom-right-radius: 25px;
    }

    .tab {
      padding: 12px 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .tab.active {
      background: white;
      color: black;
      border-radius: 20px;
    }

    .container {
      padding: 20px;
    }

    .card {
      background: white;
      border-radius: 10px;
      margin-bottom: 15px;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: pointer;
    }

    .left {
      display: flex;
      align-items: center;
    }

    .left img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .name {
      font-weight: bold;
      margin: 0;
    }

    .preview {
      font-size: 12px;
      color: gray;
    }

    .right {
      text-align: right;
    }

    .time {
      font-size: 12px;
      color: gray;
    }

    .badge {
      background: red;
      color: white;
      border-radius: 50%;
      padding: 5px 10px;
      font-size: 12px;
      margin-top: 5px;
      display: inline-block;
    }
  </style>
</head>
<body>

  <div class="tab-bar">
    <div class="tab active">Discussions</div>
    <div class="tab" onclick="window.location.href='suggestions.html'">Suggestions</div>
  </div>

  <div class="container" id="discussion-list">
    <!-- Cartes dynamiques ici -->
  </div>

  <script>
    async function chargerDiscussions() {
      try {
        const response = await fetch('/api/discussions');
        const data = await response.json();
        const container = document.getElementById('discussion-list');
        container.innerHTML = '';

        data.forEach(d => {
          const card = document.createElement('div');
          card.className = 'card';
          card.onclick = () => {
            const url = `discussion.html?nom=${encodeURIComponent(d.nom)}&prenom=${encodeURIComponent(d.prenom)}&photoUrl=${encodeURIComponent(d.photoUrl)}`;
            window.location.href = url;
          };

          card.innerHTML = `
            <div class="left">
              <img src="${d.photoUrl || 'https://via.placeholder.com/50'}" alt="photo">
              <div>
                <p class="name">${d.prenom} ${d.nom}</p>
                <p class="preview">${d.dernierMessage || ''}</p>
              </div>
            </div>
            <div class="right">
              <div class="time">${d.temps || ''}</div>
              ${d.nonLus > 0 ? `<div class="badge">${d.nonLus}</div>` : ''}
            </div>
          `;

          container.appendChild(card);
        });

      } catch (err) {
        console.error("Erreur de chargement des discussions :", err);
        document.getElementById('discussion-list').innerHTML = "<p>Impossible de charger les discussions.</p>";
      }
    }

    chargerDiscussions();
  </script>

</body>
</html>
